(()=>{"use strict";var e={n:i=>{var s=i&&i.__esModule?()=>i.default:()=>i;return e.d(s,{a:s}),s},d:(i,s)=>{for(var n in s)e.o(s,n)&&!e.o(i,n)&&Object.defineProperty(i,n,{enumerable:!0,get:s[n]})},o:(e,i)=>Object.prototype.hasOwnProperty.call(e,i)};const i=window.ReactJSXRuntime,s=window.wp.plugins,n=window.wp.editPost,t=window.wp.i18n,d=window.React,r=window.wp.primitives,o=(0,d.createElement)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,d.createElement)(r.Path,{d:"M5.5 12h1.75l-2.5 3-2.5-3H4a8 8 0 113.134 6.35l.907-1.194A6.5 6.5 0 105.5 12zm9.53 1.97l-2.28-2.28V8.5a.75.75 0 00-1.5 0V12a.747.747 0 00.218.529l1.282-.84-1.28.842 2.5 2.5a.75.75 0 101.06-1.061z"})),a=window.wp.components,l=window.wp.element,c=(0,d.createElement)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,d.createElement)(r.Path,{d:"M16.7 7.1l-6.3 8.5-3.3-2.5-.9 1.2 4.5 3.4L17.9 8z"})),g=(0,d.createElement)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,d.createElement)(r.Path,{d:"M13 11.8l6.1-6.3-1-1-6.1 6.2-6.1-6.2-1 1 6.1 6.3-6.5 6.7 1 1 6.5-6.6 6.5 6.6 1-1z"})),p=({revision:e,isAccepted:s,canAcceptRevisions:n,onApprove:d,onReject:r,onView:p})=>{const[v,w]=(0,l.useState)(!1),[u,h]=(0,l.useState)(!1),m=async()=>{if(!v&&!u){if("rejected"===e.status&&!confirm((0,t.__)("This revision was previously rejected. Are you sure you want to republish it?","dgwltd-pending-revisions")))return;w(!0);try{await d(e.id)}finally{w(!1)}}},x=n&&!s&&"rejected"!==e.status,j=n&&!s&&"rejected"===e.status;return(0,i.jsx)("div",{className:"dgw-revision-item",children:(0,i.jsxs)(a.Flex,{direction:"column",gap:2,children:[(0,i.jsx)(a.FlexItem,{children:(0,i.jsxs)(a.Flex,{justify:"space-between",align:"center",children:[(0,i.jsx)(a.FlexItem,{children:s?(0,i.jsxs)("span",{className:"dgw-revision-status dgw-revision-status--accepted",children:[(0,i.jsx)(a.Icon,{icon:c,size:16}),(0,t.__)("Published","dgwltd-pending-revisions")]}):"rejected"===e.status?(0,i.jsxs)("span",{className:"dgw-revision-status dgw-revision-status--rejected",children:[(0,i.jsx)(a.Icon,{icon:g,size:16}),(0,t.__)("Rejected","dgwltd-pending-revisions")]}):(0,i.jsxs)("span",{className:"dgw-revision-status dgw-revision-status--pending",children:[(0,i.jsx)(a.Icon,{icon:o,size:16}),(0,t.__)("Pending","dgwltd-pending-revisions")]})}),(0,i.jsx)(a.FlexItem,{children:(0,i.jsx)("span",{className:"dgw-revision-date",title:(_=e.date,new Date(_).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})),children:(e=>{const i=new Date(e+(e.includes("Z")?"":"Z")),s=(new Date).getTime()-i.getTime(),n=Math.floor(s/6e4),d=Math.floor(n/60),r=Math.floor(d/24);return n<1?(0,t.__)("Just now","dgwltd-pending-revisions"):n<60?`${n} ${(0,t.__)("minutes ago","dgwltd-pending-revisions")}`:d<24?`${d} ${(0,t.__)("hours ago","dgwltd-pending-revisions")}`:`${r} ${(0,t.__)("days ago","dgwltd-pending-revisions")}`})(e.date)})})]})}),(0,i.jsxs)(a.FlexItem,{children:[(0,i.jsxs)("div",{className:"dgw-revision-meta",children:[(0,i.jsx)("strong",{children:(0,t.__)("Author:","dgwltd-pending-revisions")})," ",e.author_name]}),e.title.rendered&&(0,i.jsxs)("div",{className:"dgw-revision-title",children:[(0,i.jsx)("strong",{children:(0,t.__)("Title:","dgwltd-pending-revisions")}),(0,i.jsx)("span",{title:e.title.rendered,children:e.title.rendered.length>50?`${e.title.rendered.substring(0,50)}...`:e.title.rendered})]}),(0,i.jsxs)("div",{className:"dgw-revision-version",children:[(0,i.jsx)("strong",{children:(0,t.__)("Version: ","dgwltd-pending-revisions")}),(0,i.jsxs)("a",{href:`${window.location.origin}/wp-admin/revision.php?revision=${e.id}`,target:"_blank",rel:"noopener noreferrer",children:["#",e.id]})]})]}),(0,i.jsx)(a.FlexItem,{children:(0,i.jsxs)(a.Flex,{justify:"space-between",align:"center",children:[x&&(0,i.jsx)(a.FlexItem,{children:(0,i.jsxs)(a.ButtonGroup,{children:[(0,i.jsx)(a.Button,{isSmall:!0,variant:"primary",icon:c,isBusy:v,disabled:u,onClick:m,children:(0,t.__)("Approve","dgwltd-pending-revisions")}),(0,i.jsx)(a.Button,{isSmall:!0,variant:"secondary",icon:g,isBusy:u,disabled:v,onClick:async()=>{if(!v&&!u){h(!0);try{await r(e.id)}finally{h(!1)}}},children:(0,t.__)("Reject","dgwltd-pending-revisions")})]})}),j&&(0,i.jsx)(a.FlexItem,{children:(0,i.jsx)(a.Button,{isSmall:!0,variant:"secondary",icon:o,isBusy:v,disabled:u,onClick:m,children:(0,t.__)("Republish","dgwltd-pending-revisions")})})]})})]})});var _},v=({revisions:e,acceptedRevisionId:s,canAcceptRevisions:n,onApprove:d,onReject:r,onRefresh:o})=>{const[c,g]=(0,l.useState)("all"),[v,w]=(0,l.useState)(!1),u=e=>{const i=new URL(window.location.href);i.searchParams.set("revision",e.toString()),window.open(i.toString(),"_blank")},h=(()=>{switch(c){case"pending":return e.filter(e=>e.is_pending&&"rejected"!==e.status);case"accepted":return e.filter(e=>e.is_accepted);case"rejected":return e.filter(e=>"rejected"===e.status);default:return e}})(),m=e.filter(e=>e.is_pending&&"rejected"!==e.status).length,x=e.filter(e=>e.is_accepted).length,j=e.filter(e=>"rejected"===e.status).length;return(0,i.jsxs)("div",{className:"dgw-revisions-list",children:[(0,i.jsx)("div",{className:"dgw-revisions-filters",children:(0,i.jsxs)(a.ButtonGroup,{children:[(0,i.jsxs)(a.Button,{isSmall:!0,variant:"all"===c?"primary":"secondary",onClick:()=>g("all"),children:[(0,t.__)("All","dgwltd-pending-revisions")," (",e.length,")"]}),m>0&&(0,i.jsxs)(a.Button,{isSmall:!0,variant:"pending"===c?"primary":"secondary",onClick:()=>g("pending"),children:[(0,t.__)("Pending","dgwltd-pending-revisions")," (",m,")"]}),x>0&&(0,i.jsxs)(a.Button,{isSmall:!0,variant:"accepted"===c?"primary":"secondary",onClick:()=>g("accepted"),children:[(0,t.__)("Accepted","dgwltd-pending-revisions")," (",x,")"]}),j>0&&(0,i.jsxs)(a.Button,{isSmall:!0,variant:"rejected"===c?"primary":"secondary",onClick:()=>g("rejected"),children:[(0,t.__)("Rejected","dgwltd-pending-revisions")," (",j,")"]})]})}),(0,i.jsx)("div",{className:"dgw-revisions-actions",children:(0,i.jsx)(a.Button,{isSmall:!0,variant:"tertiary",isBusy:v,onClick:async()=>{w(!0),await o(),w(!1)},children:(0,t.__)("Refresh","dgwltd-pending-revisions")})}),(0,i.jsx)("div",{className:"dgw-revisions-items",children:h.length>0?h.map(e=>(0,i.jsx)(p,{revision:e,isAccepted:e.id===s,canAcceptRevisions:n,onApprove:d,onReject:r,onView:u},e.id)):(0,i.jsx)("div",{className:"dgw-no-revisions-filtered",children:"all"===c?(0,i.jsx)("p",{children:(0,t.__)("No revisions found.","dgwltd-pending-revisions")}):(0,i.jsxs)("p",{children:["pending"===c&&(0,t.__)("No pending revisions.","dgwltd-pending-revisions"),"accepted"===c&&(0,t.__)("No accepted revisions.","dgwltd-pending-revisions"),"rejected"===c&&(0,t.__)("No rejected revisions.","dgwltd-pending-revisions")]})})}),(0,i.jsx)("div",{className:"dgw-revisions-help",children:(0,i.jsx)("p",{className:"description",children:n?(0,t.__)("Click on a revision to view details, or use the approve/reject buttons to manage pending revisions.","dgwltd-pending-revisions"):(0,t.__)("Contact an editor to approve or reject pending revisions.","dgwltd-pending-revisions")})})]})},w=(0,d.createElement)(r.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,d.createElement)(r.Path,{d:"M17 10h-1.2V7c0-2.1-1.7-3.8-3.8-3.8-2.1 0-3.8 1.7-3.8 3.8h1.5c0-1.2 1-2.2 2.2-2.2s2.2 1 2.2 2.2v3H7c-.6 0-1 .4-1 1v8c0 .6.4 1 1 1h10c.6 0 1-.4 1-1v-8c0-.6-.4-1-1-1z"})),u=(0,d.createElement)(r.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,d.createElement)(r.Path,{d:"M12 3.2c-4.8 0-8.8 3.9-8.8 8.8 0 4.8 3.9 8.8 8.8 8.8 4.8 0 8.8-3.9 8.8-8.8 0-4.8-4-8.8-8.8-8.8zm0 16c-4 0-7.2-3.3-7.2-7.2C4.8 8 8 4.8 12 4.8s7.2 3.3 7.2 7.2c0 4-3.2 7.2-7.2 7.2zM11 17h2v-6h-2v6zm0-8h2V7h-2v2z"})),h=(0,d.createElement)(r.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,d.createElement)(r.Path,{d:"M17 10h-1.2V7c0-2.1-1.7-3.8-3.8-3.8-2.1 0-3.8 1.7-3.8 3.8v3H7c-.6 0-1 .4-1 1v8c0 .6.4 1 1 1h10c.6 0 1-.4 1-1v-8c0-.6-.4-1-1-1zm-2.8 0H9.8V7c0-1.2 1-2.2 2.2-2.2s2.2 1 2.2 2.2v3z"})),m=({totalRevisions:e,pendingCount:s,acceptedRevision:n,editingMode:d})=>{const r=(e=>{switch(e){case"open":return{icon:w,label:(0,t.__)("Open","dgwltd-pending-revisions"),className:"dgw-mode-open"};case"pending":return{icon:u,label:(0,t.__)("Requires Approval","dgwltd-pending-revisions"),className:"dgw-mode-pending"};case"locked":return{icon:h,label:(0,t.__)("Locked","dgwltd-pending-revisions"),className:"dgw-mode-locked"};default:return{icon:w,label:(0,t.__)("Unknown","dgwltd-pending-revisions"),className:"dgw-mode-unknown"}}})(d);return(0,i.jsx)("div",{className:"dgw-revision-stats",children:(0,i.jsxs)(a.Flex,{direction:"column",gap:3,children:[(0,i.jsx)(a.FlexItem,{children:(0,i.jsx)("div",{className:`dgw-stat-item ${r.className}`,children:(0,i.jsxs)(a.Flex,{align:"flex-start",justify:"auto",gap:2,children:[(0,i.jsx)(a.FlexItem,{children:(0,i.jsx)(a.Icon,{icon:r.icon,size:20})}),(0,i.jsx)(a.FlexItem,{children:(0,i.jsxs)("div",{className:"dgw-stat-content",children:[(0,i.jsx)("span",{className:"dgw-stat-label",children:(0,t.__)("Editing Mode","dgwltd-pending-revisions")}),(0,i.jsx)("span",{className:"dgw-stat-value",children:r.label})]})})]})})}),(0,i.jsx)(a.FlexItem,{children:(0,i.jsx)("div",{className:"dgw-stat-item",children:(0,i.jsxs)(a.Flex,{align:"flex-start",justify:"auto",gap:2,children:[(0,i.jsx)(a.FlexItem,{children:(0,i.jsx)(a.Icon,{icon:o,size:20})}),(0,i.jsx)(a.FlexItem,{children:(0,i.jsxs)("div",{className:"dgw-stat-content",children:[(0,i.jsx)("span",{className:"dgw-stat-label",children:(0,t.__)("Total Revisions","dgwltd-pending-revisions")}),(0,i.jsx)("span",{className:"dgw-stat-value",children:e})]})})]})})}),s>0&&(0,i.jsx)(a.FlexItem,{children:(0,i.jsx)("div",{className:"dgw-stat-item dgw-stat-pending",children:(0,i.jsxs)(a.Flex,{align:"flex-start",justify:"auto",gap:2,children:[(0,i.jsx)(a.FlexItem,{children:(0,i.jsx)(a.Icon,{icon:u,size:20})}),(0,i.jsx)(a.FlexItem,{children:(0,i.jsxs)("div",{className:"dgw-stat-content",children:[(0,i.jsx)("span",{className:"dgw-stat-label",children:(0,t.__)("Pending Approval","dgwltd-pending-revisions")}),(0,i.jsx)("span",{className:"dgw-stat-value dgw-stat-highlight",children:s})]})})]})})}),n&&(0,i.jsx)(a.FlexItem,{children:(0,i.jsx)("div",{className:"dgw-stat-item dgw-stat-published",children:(0,i.jsxs)(a.Flex,{align:"flex-start",justify:"auto",gap:2,children:[(0,i.jsx)(a.FlexItem,{children:(0,i.jsx)(a.Icon,{icon:c,size:20})}),(0,i.jsx)(a.FlexItem,{children:(0,i.jsxs)("div",{className:"dgw-stat-content dgw-stat-content--meta",children:[(0,i.jsx)("span",{className:"dgw-stat-label",children:(0,t.__)("Currently Published","dgwltd-pending-revisions")}),(0,i.jsxs)("span",{className:"dgw-stat-value",children:[(0,t.__)("By","dgwltd-pending-revisions")," ",n.author_name]}),(0,i.jsx)("span",{className:"dgw-stat-meta",title:(l=n.date,new Date(l).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})),children:(e=>{const i=new Date(e),s=(new Date).getTime()-i.getTime(),n=Math.floor(s/36e5),d=Math.floor(n/24);return n<1?(0,t.__)("Less than an hour ago","dgwltd-pending-revisions"):n<24?`${n} ${(0,t.__)("hours ago","dgwltd-pending-revisions")}`:1===d?(0,t.__)("1 day ago","dgwltd-pending-revisions"):`${d} ${(0,t.__)("days ago","dgwltd-pending-revisions")}`})(n.date)})]})})]})})}),0===e&&(0,i.jsx)(a.FlexItem,{children:(0,i.jsx)("div",{className:"dgw-stat-item dgw-stat-empty",children:(0,i.jsx)("p",{className:"description",children:(0,t.__)("No revisions have been created for this post yet.","dgwltd-pending-revisions")})})})]})});var l},x=window.wp.apiFetch;var j=e.n(x);const _=()=>{const[e,s]=(0,l.useState)(null),n=window.dgwPendingRevisionsEditorData||{},{postId:d,editingMode:r,canAcceptRevisions:o,acceptedRevisionId:c}=n,{revisions:g,isLoading:p,error:w,refetch:u,approveRevision:h,rejectRevision:x}=(e=>{const[i,s]=(0,l.useState)([]),[n,d]=(0,l.useState)(!0),[r,o]=(0,l.useState)(null),a=(window.dgwPendingRevisionsEditorData,(0,l.useCallback)(async()=>{if(e)try{d(!0),o(null);const i=await j()({path:`/dgw-pending-revisions/v1/revisions/${e}`,method:"GET"});if(!i.success||!i.data)throw new Error(i.message||(0,t.__)("Failed to fetch revisions","dgwltd-pending-revisions"));s(i.data)}catch(e){o(e.message||(0,t.__)("An error occurred while fetching revisions","dgwltd-pending-revisions")),console.error("Error fetching revisions:",e)}finally{d(!1)}},[e])),c=(0,l.useCallback)(async i=>{try{const s=await j()({path:`/dgw-pending-revisions/v1/revisions/${e}/${i}/approve`,method:"POST"});if(s.success)return await a(),!0;throw new Error(s.message||(0,t.__)("Failed to approve revision","dgwltd-pending-revisions"))}catch(e){return o(e.message||(0,t.__)("An error occurred while approving revision","dgwltd-pending-revisions")),console.error("Error approving revision:",e),!1}},[e,a]),g=(0,l.useCallback)(async i=>{try{const s=await j()({path:`/dgw-pending-revisions/v1/revisions/${e}/${i}/reject`,method:"POST"});if(s.success)return await a(),!0;throw new Error(s.message||(0,t.__)("Failed to reject revision","dgwltd-pending-revisions"))}catch(e){return o(e.message||(0,t.__)("An error occurred while rejecting revision","dgwltd-pending-revisions")),console.error("Error rejecting revision:",e),!1}},[e,a]);return(0,l.useEffect)(()=>{a()},[a]),{revisions:i,isLoading:n,error:r,refetch:a,approveRevision:c,rejectRevision:g}})(d);(0,l.useEffect)(()=>{s(w?{type:"error",message:w,dismissible:!0}:null)},[w]);const _=g.filter(e=>e.is_pending&&"rejected"!==e.status),y=g.find(e=>e.is_accepted);return(0,i.jsxs)("div",{className:"dgw-pending-revisions-panel",children:[e&&(0,i.jsx)(a.Notice,{status:e.type,onRemove:e.dismissible?()=>{s(null)}:void 0,isDismissible:e.dismissible,children:e.message}),(0,i.jsx)(a.PanelBody,{title:(0,t.__)("Revision Status","dgwltd-pending-revisions"),initialOpen:!0,children:(0,i.jsx)(m,{totalRevisions:g.length,pendingCount:_.length,acceptedRevision:y,editingMode:r})}),(0,i.jsx)(a.PanelBody,{title:(0,t.__)("Revisions","dgwltd-pending-revisions"),initialOpen:!0,children:p?(0,i.jsxs)("div",{className:"dgw-loading-container",children:[(0,i.jsx)(a.Spinner,{}),(0,i.jsx)("p",{children:(0,t.__)("Loading revisions...","dgwltd-pending-revisions")})]}):g.length>0?(0,i.jsx)(v,{revisions:g,acceptedRevisionId:c,canAcceptRevisions:o,onApprove:async e=>{await h(e)&&s({type:"success",message:(0,t.__)("Revision approved successfully!","dgwltd-pending-revisions"),dismissible:!0})},onReject:async e=>{await x(e)&&s({type:"success",message:(0,t.__)("Revision rejected successfully!","dgwltd-pending-revisions"),dismissible:!0})},onRefresh:u}):(0,i.jsx)("p",{className:"dgw-no-revisions",children:(0,t.__)("No revisions found for this post.","dgwltd-pending-revisions")})})]})};(0,s.registerPlugin)("dgw-pending-revisions-sidebar",{render:()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.PluginSidebarMoreMenuItem,{target:"dgw-pending-revisions-sidebar",icon:o,children:(0,t.__)("Pending Revisions","dgwltd-pending-revisions")}),(0,i.jsx)(n.PluginSidebar,{name:"dgw-pending-revisions-sidebar",icon:o,title:(0,t.__)("Pending Revisions","dgwltd-pending-revisions"),className:"dgw-pending-revisions-sidebar",children:(0,i.jsx)(_,{})})]}),icon:o});const y=window.wp.data,f=({data:e})=>{const{postId:i,editingMode:s,canAcceptRevisions:n}=e,{isIntercepting:d}=(({postId:e,editingMode:i,canAcceptRevisions:s})=>{const{savePost:n,lockPostSaving:d,unlockPostSaving:r}=(0,y.useDispatch)("core/editor"),{createNotice:o}=(0,y.useDispatch)("core/notices"),{postType:a,isDirty:c,isSaving:g,isAutosaving:p,editedPostContent:v,editedPostTitle:w,editedPostExcerpt:u,getCurrentPost:h}=(0,y.useSelect)(e=>{const i=e("core/editor");return{postType:i.getCurrentPostType(),isDirty:i.isEditedPostDirty(),isSaving:i.isSavingPost(),isAutosaving:i.isAutosavingPost(),editedPostContent:i.getEditedPostContent(),editedPostTitle:i.getEditedPostAttribute("title"),editedPostExcerpt:i.getEditedPostAttribute("excerpt"),getCurrentPost:i.getCurrentPost()}},[]),m=(0,l.useCallback)(async i=>{try{const s={post_parent:e,post_title:i.title,post_content:i.content,post_excerpt:i.excerpt,post_type:"revision",post_status:"inherit",meta:{_dgw_revision_status:"pending"}};if(await j()({path:"/dgw-pending-revisions/v1/revisions",method:"POST",data:s}))return o("success",(0,t.__)("Changes saved as pending revision and submitted for approval.","dgwltd-pending-revisions"),{type:"snackbar",isDismissible:!0}),!0}catch(e){console.error("Failed to create pending revision:",e),o("error",(0,t.__)("Failed to save pending revision. Please try again.","dgwltd-pending-revisions"),{type:"snackbar",isDismissible:!0})}return!1},[e,o]),x=(0,l.useCallback)(async()=>!("pending"===i&&!s&&!p&&c&&(d(),await m({title:w,content:v,excerpt:u})?setTimeout(()=>{r()},100):r(),1)),[i,s,p,c,w,v,u,d,r,m]);return(0,l.useEffect)(()=>{if("pending"!==i||s)return;const e=e=>{(e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),e.stopPropagation(),x())};return document.addEventListener("keydown",e,!0),()=>{document.removeEventListener("keydown",e,!0)}},[i,s,x]),(0,l.useEffect)(()=>{if("pending"!==i||s)return;const e=e=>{const i=e.target;(i.classList.contains("editor-post-save-draft")||i.classList.contains("editor-post-publish-button")||i.classList.contains("editor-post-publish-panel__toggle"))&&(e.preventDefault(),e.stopPropagation(),x())};return document.addEventListener("click",e,!0),()=>{document.removeEventListener("click",e,!0)}},[i,s,x]),{isIntercepting:"pending"===i&&!s,interceptSave:x}})({postId:i||0,editingMode:s||"open",canAcceptRevisions:n||!1});return(0,l.useEffect)(()=>{},[d]),null};(0,s.registerPlugin)("dgw-pending-revisions-save-interceptor",{render:()=>{const e=window.dgwPendingRevisionsEditorData||{};return(0,i.jsx)(f,{data:e})}});const b=()=>{window.dgwPendingRevisionsEditorData?window.dgwPendingRevisionsEditorData:console.warn("DGW Pending Revisions: Editor data not found")};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",b):b()})();