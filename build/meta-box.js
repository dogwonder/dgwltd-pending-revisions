(()=>{"use strict";var e={n:s=>{var i=s&&s.__esModule?()=>s.default:()=>s;return e.d(i,{a:i}),i},d:(s,i)=>{for(var n in i)e.o(i,n)&&!e.o(s,n)&&Object.defineProperty(s,n,{enumerable:!0,get:i[n]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s)};const s=window.wp.apiFetch;var i=e.n(s);const n=window.wp.i18n,t=()=>{document.querySelectorAll(".dgw-quick-switch-btn").forEach(e=>{e.addEventListener("click",o)})},o=async e=>{e.preventDefault();const s=e.target,i=parseInt(s.dataset.postId||"0",10),t=parseInt(s.dataset.revisionId||"0",10),o=s.dataset.revisionStatus||"pending",a=s.innerHTML;if(!i||!t)return void console.error("Missing post ID or revision ID");const u=d(o,s);if(!u||confirm(u)){c(s,"loading",`🔄 ${(0,n.__)("Publishing...","dgwltd-pending-revisions")}`);try{const e=await r({postId:i,revisionId:t,reason:"Quick switch from meta box"});if(!e.success)throw new Error(e.message||(0,n.__)("Failed to publish revision","dgwltd-pending-revisions"));c(s,"success",`✅ ${(0,n.__)("Published!","dgwltd-pending-revisions")}`),l("success",(0,n.__)("Revision published successfully! Page will refresh to show changes.","dgwltd-pending-revisions")),setTimeout(()=>{window.location.assign(window.location.href)},2e3)}catch(e){const i=e instanceof Error?e.message:(0,n.__)("Failed to publish revision","dgwltd-pending-revisions");c(s,"error",`❌ ${(0,n.__)("Failed - Retry","dgwltd-pending-revisions")}`),l("error",i),setTimeout(()=>{s.innerHTML=a,s.disabled=!1,s.className=s.className.replace(/\s*(loading|error|success)/g,"")},3e3)}}},r=async e=>await i()({path:`/dgw-pending-revisions/v1/posts/${e.postId}/set-published-revision`,method:"POST",data:{revision_id:e.revisionId,reason:e.reason}}),d=(e,s)=>"rejected"===e?(0,n.__)("This revision was previously rejected. Are you sure you want to republish it?","dgwltd-pending-revisions"):a(s)?(0,n.__)("This revision is more than 24 hours old. Are you sure you want to publish it?","dgwltd-pending-revisions"):null,a=e=>{const s=e.closest("tr");if(!s)return!1;const i=s.querySelector("td:nth-child(2)");if(!i)return!1;const n=i.textContent?.trim()||"",t=new Date,o=(new Date(t.getTime()-864e5),t.toDateString().slice(4,10));return!n.includes(o)},c=(e,s,i)=>{e.className=e.className.replace(/\s*(loading|error|success)/g,""),e.classList.add(s),e.innerHTML=i,e.disabled="loading"===s},l=(e,s)=>{const i=document.createElement("div");i.className=`notice notice-${e} is-dismissible`,i.innerHTML=`<p>${s}</p>`;const n=document.querySelector(".wrap h1");n&&n.parentNode&&(n.parentNode.insertBefore(i,n.nextSibling),"success"===e&&setTimeout(()=>{i.remove()},3e3))};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()})();